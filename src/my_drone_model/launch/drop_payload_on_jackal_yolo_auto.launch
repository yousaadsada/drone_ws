<!-- launch/test.launch -->
<launch>
  <!-- Quadrotor URDF -->
  <param name="quadrotor/robot_description"
         command="$(find xacro)/xacro '$(find my_drone_model)/urdf/quadrotor.urdf'"/>

  <param name="ball/robot_description"
         command="$(find xacro)/xacro '$(find my_drone_model)/urdf/ball.urdf'"/>

  <include file="$(find gazebo_ros)/launch/empty_world.launch">
    <arg name="paused" value="false"/>
    <arg name="use_sim_time" value="true"/>
    <arg name="gui" value="true"/>
  </include>



  <node name="spawn_quad" pkg="gazebo_ros" type="spawn_model" output="screen" 
        args="-param quadrotor/robot_description -urdf -model quadrotor  -z 0.075"/>
     
  <node name="spawn_ball" pkg="gazebo_ros" type="spawn_model" output="screen"
        args="-param ball/robot_description -urdf -model ball  -z 0.015"
        launch-prefix="bash -c 'sleep 5; $0 $@'" />

  <node pkg="topic_tools" type="throttle" name="throttle_link_states"
        args="messages /gazebo/link_states 100.0 /gazebo/link_states_throttled"/>

  <node name="gripper_controller_auto" pkg="my_drone_model"
        type="gripper_controller_auto.py" output="screen"/>            
  
  <node name="camera_pitch_controller_auto" pkg="my_drone_model"
        type="camera_pitch_controller_auto.py" output="screen"/>

  <node name="jackal_control_auto" pkg="my_drone_model"
        type="jackal_control_auto.py" output="screen"/>

  <node name="drop_payload_on_jackal_yolo_auto" pkg="my_drone_model"
        type="drop_payload_on_jackal_yolo_auto.py" output="screen"/>

  <node name="quadrotor_wrench_control" pkg="my_drone_model"
        type="quadrotor_wrench_control.py" output="screen"/> 

  <node name="keypoint_detection" pkg="my_drone_model"
        type="keypoint_detection.py" output="screen"/>

  <node name="get_jackal_pos" pkg="my_drone_model"
        type="get_jackal_pos.py" output="screen"/>

  <node name="kalman_filter_velocity_estimation" pkg="my_drone_model"
        type="kalman_filter_velocity_estimation.py" output="screen"/>
 
  <arg name="front_laser" default="false" />
  <arg name="default_config" value="front_laser" if="$(arg front_laser)" />
  <arg name="default_config" value="base" unless="$(arg front_laser)" />

  <arg name="config" default="$(arg default_config)" />

  <arg name="joystick" default="true" />

  <include file="$(find jackal_gazebo)/launch/spawn_jackal.launch">
    <arg name="x" value="3" />
    <arg name="y" value="0" />
    <arg name="z" value="1.0" />
    <arg name="yaw" value="0.785" />
    <arg name="config" value="$(arg config)" />
    <arg name="joystick" value="$(arg joystick)" />
  </include>

  <rosparam file="$(find my_drone_model)/config/propeller_controller.yaml" command="load"/>

  <node name="quadrotor_controller_spawner" pkg="controller_manager" type="spawner" ns="quadrotor"
        args="quadrotor_propeller_1_joint_velocity_controller
              quadrotor_propeller_2_joint_velocity_controller
              quadrotor_propeller_3_joint_velocity_controller
              quadrotor_propeller_4_joint_velocity_controller
              quadrotor_camera_pitch_controller
              left_finger_controller
              right_finger_controller"
        output="screen"/>



</launch>



